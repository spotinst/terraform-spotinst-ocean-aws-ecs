# Spot Ocean ECS Terraform Module

## Prerequisites
* Have an ECS cluster
* Spot Account and API Token defined in the Spotinst Terraform Provider

## Usage
```hcl
module "ocean_ecs" {
  source = "spotinst/ocean-aws-ecs/spotinst"

  cluster_name                    = "ECS-Workshop"
  region                          = "us-west-2"
  subnet_ids                      = ["subnet-123456789,subnet-123456789"]
  security_group_ids              = ["sg-123456789"]
  image_id                        = "ami-123456789"
  iam_instance_profile            = "arn:aws:iam::123456789:instance-profile/ecsInstanceRole"
  availability_vs_cost            = "costOriented"

  tags = {CreatedBy = "terraform"}
}
```

## Providers

| Name | Version   |
|------|-----------|
| spotinst | >= 1.78.0 |

## Modules
* `ecs-ocean` - Creates Ocean Cluster
* `ecs-ocean-launchspec` - (Optional) Add custom virtual node groups [Doc](https://registry.terraform.io/modules/spotinst/ocean-aws-ecs-vng/spotinst/latest)

## Inputs

| Name                                                                                                                    | Description                                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Default      | Required |
|-------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|:--------:|
| <a name="input_cluster_name"></a> [cluster\_name](#input\_cluster\_name)                                                | Add a name for the Ocean cluster.                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`       |   yes    |
| <a name="input_availability_vs_cost"></a> [availability\_vs\_cost](#input\_availability\_vs\_cost)                      | (Optional, Default: balanced) You can control the approach that Ocean takes while launching nodes by configuring this value. Possible values: costOriented,balanced,cheapest.                                         | `string`  | `balanced`   |    no    |
| <a name="input_region"></a> [region](#input\_region)                                                                    | The region the cluster is located                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a          | yes |
| <a name="input_max_size"></a> [max\_size](#input\_max\_size)                                                            | The upper limit of worker nodes the Ocean cluster can scale up to                                                                                                                                                     | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `1000`       | no |
| <a name="input_min_size"></a> [min\_size](#input\_min\_size)                                                            | The lower limit of worker nodes the Ocean cluster can scale down to                                                                                                                                                   | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`          | no |
| <a name="input_desired_capacity"></a> [desired\_capacity](#input\_desired\_capacity)                                    | The number of instances to launch and maintain in the cluster.<br/>                                                                                                                                                   | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`       | no |
| <a name="input_subnet_ids"></a> [subnet\_ids](#input\_subnet\_ids)                                                      | A comma-separated list of subnet identifiers for the Ocean cluster. Subnet identifiers should be configured with auto-assign public IP.                                                                               | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | n/a          | yes |
| <a name="input_whitelist"></a> [whitelist](#input\_whitelist)                                                           | Instance types allowed in the Ocean cluster. Cannot be configured if a deny list is configured.                                                                                                                       | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `null`       | no |
| <a name="input_user_data"></a> [user\_data](#input\_user\_data)                                                         | The base 64 encoded MIME user data to make available to the instances.                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`       | no |
| <a name="input_image_id"></a> [image_id](#input\_image\_id)                                                             | identifier of the image used to launch the instances.                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a          | yes |
| <a name="input_security_groups_ids"></a> [security\_groups\_ids](#input\_security\_groups\_ids)                         | One or more security group identifiers.                                                                                                                                                                               | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | n/a          | yes |
| <a name="input_iam_instance_profile"></a> [iam\_instance\_profile](#input\_iam_instance\_profile)                       | The instance profile iamRole.                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`       | no |
| <a name="input_associate_public_ip_address"></a> [associate\_public\_ip\_address](#input\_associate\_public\_ip\_address) | (Optional, Default: false) Configure public IP address allocation.                                                                                                                                                    | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`      | no |
| <a name="input_utilize_reserved_instances"></a> [utilize\_reserved\_instances](#input\_utilize\_reserved\_instances)    | If there are any vacant Reserved Instances, launch On-Demand to consume them                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `true`       | no |
| <a name="input_draining_timeout"></a> [draining\_timeout](#input\_draining\_timeout)                                    | The time in seconds, the instance is allowed to run while detached from the ELB. This is to allow the instance time to be drained from incoming TCP connections before terminating it, during a scale down operation. | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `120`        | no |
| <a name="input_monitoring"></a> [monitoring](#input\_monitoring)                                                        | Enable detailed monitoring for cluster. Flag will enable Cloud Watch detailed monitoring (one minute increments). Note: there are additional hourly costs for this service based on the region used.                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`      | no |
| <a name="input_spot_percentage"></a> [spot\_percentage](#input\_spot\_percentage)                                       | The percentage of Spot instances                                                                                                                                                                                      | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`       | no |
| <a name="input_utilize_commitments"></a> [utilize\_commitments](#input\_utilize\_commitments)                           | If savings plans commitment has available capacity, Ocean will utilize them alongside RIs (if exist) to maximize cost efficiency.                                                                                     | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`      | no |
| <a name="input_http_tokens"></a> [http\_tokens](#input\_http\_tokens)                                                   | Determines if a signed token is required or not. Valid values: optional or required.                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"optional"` | no |
| <a name="input_fallback_to_ondemand"></a> [fallback\_to\_ondemand](#input\_utilize\_commitments)             | Launch On-Demand in the event there are no spot instances available.                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `true`       | no |

## Documentation

If you're new to [Spot](https://spot.io/) and want to get started, please checkout our [Getting Started](https://docs.spot.io/connect-your-cloud-provider/) guide, available on the [Spot Documentation](https://docs.spot.io/) website.

## Getting Help

We use GitHub issues for tracking bugs and feature requests. Please use these community resources for getting help:

- Ask a question on [Stack Overflow](https://stackoverflow.com/) and tag it with [terraform-spotinst](https://stackoverflow.com/questions/tagged/terraform-spotinst/).
- Join our [Spot](https://spot.io/) community on [Slack](http://slack.spot.io/).
- Open an issue.

## Community

- [Slack](http://slack.spot.io/)
- [Twitter](https://twitter.com/spot_hq/)

## Contributing

Please see the [contribution guidelines](CONTRIBUTING.md).

## License

Code is licensed under the [Apache License 2.0](LICENSE).